<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Categoría</title>
  <link rel="stylesheet" href="../estilos/estilosCategorias.css">
</head>
<body>
    <div class="container">
        <h1>Editar Categoría</h1>

        <label for="categoriaSelect">Selecciona una categoría:</label>x
        <select id="categoriaSelect" required>
            <option value="">-- Selecciona una categoría --</option>
        </select> 

        <br><br>

        <label for="nuevoNombre">Nuevo nombre:</label>
        <input type="text" id="nuevoNombre" placeholder="Nuevo nombre de la categoría" required>


        <label for="nuevoTipo">Nuevo tipo:</label>
        <input type="text" id="nuevoTipo" placeholder="Nuevo tipo de la categoría" required>  

        <label for="nuevoDescripcion">Nueva Descripción:</label>
        <input type="text" id="nuevoDescripcion" placeholder="Nueva descripción de la categoría" required>

        <br><br>
        <button id="btnActualizar">Actualizar Categoría</button>

        <p id="mensaje"></p>
    </div>
  <script>
    document.getElementById("btnActualizar").addEventListener("click", () => {
      const id = document.getElementById("categoriaSelect").value;
      const nuevoNombre = document.getElementById("nuevoNombre").value.trim();
      const nuevoTipo = document.getElementById("nuevoTipo").value.trim();
      const nuevoDescripcion = document.getElementById("nuevoDescripcion").value.trim();

      if (!id) {
        document.getElementById("mensaje").textContent = "Debes seleccionar una categoría";
        return;
      }
      if (!nuevoNombre && !nuevoTipo && !nuevoDescripcion) {
        document.getElementById("mensaje").textContent = "Debes ingresar los campos nombre, tipo y descripción para actualizar";
        return;
      }
      if (nuevoNombre.length < 3) {
        document.getElementById("mensaje").textContent = "El nombre debe tener al menos 3 caracteres";
        return;
      }
      if (nuevoTipo.length < 3) {
        document.getElementById("mensaje").textContent = "El tipo debe tener al menos 3 caracteres";
        return;
      }
      if (nuevoDescripcion.length < 3) {
        document.getElementById("mensaje").textContent = "La descripción debe tener al menos 3 caracteres";
        return;
      }
      // Solo enviamos los campos que el usuario modificó
      const datos = { id: id };
      if (nuevoNombre !== "") datos.nombre = nuevoNombre;
      if (nuevoTipo !== "") datos.tipo = nuevoTipo;
      if (nuevoDescripcion !== "") datos.descripcion = nuevoDescripcion;

      fetch("../api/actualizar_categorias.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(datos)
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("mensaje").textContent = data.mensaje;

        // Actualizar el select si cambió el nombre
        const select = document.getElementById("categoriaSelect");
        const option = select.querySelector(`option[value="${id}"]`);
        if (option && nuevoNombre) option.textContent = nuevoNombre;

        // Limpiar inputs
        document.getElementById("nuevoNombre").value = "";
        document.getElementById("nuevoTipo").value = "";
        document.getElementById("nuevoDescripcion").value = "";
      })
      .catch(err => {
        document.getElementById("mensaje").textContent = "Debes rellenar todos los campos";
      });
    });

    // Cargar categorías al iniciar
    fetch("../api/obtener_categorias.php")
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("categoriaSelect");
        data.forEach(cat => {
          let option = document.createElement("option");
          option.value = cat.id;
          option.textContent = cat.nombre;
          select.appendChild(option);
        });
      })
  </script>
</body>
</html>
